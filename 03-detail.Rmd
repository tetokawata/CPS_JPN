# Detail

- Describe labor market after 2011.

- Report rates of workers who are employed primarily or partly.

## Environment

```{r}
library(data.table)
library(tidytable)
library(tidyverse)
library(lubridate)
```

## Data status

```{r}
raw <- 
  read_csv("data/aggregate_time_series.csv") %>%
  mutate(date = ymd(date),
         year = year(date),
         month = month(date),
         quaterly = if_else(month >= 1 & month <= 3, 1, 0),
         quaterly = if_else(month >= 4 & month <= 6, 2, quaterly),
         quaterly = if_else(month >= 7 & month <= 9, 3, quaterly),
         quaterly = if_else(month >= 10 & month <= 12, 4, quaterly),
         work = as.numeric(主に仕事),
         work_study_house = as.numeric(`通学・家事などのかたわらに仕事`),
         population = as.numeric(`15歳以上人口`),
         sex = if_else(性別 == "男", "male", "female")
         ) %>%
  arrange(sex,year,quaterly) %>%
  group_by(sex,year,quaterly) %>%
  mutate(work = sum(work),
         work_study_house = sum(work_study_house),
         population = sum(population)
         ) %>%
  ungroup %>%
  mutate(work_rate = work/population,
         work_study_house_rate = work_study_house/population) %>%
  filter(month == 1 | 
           month == 4 | 
           month == 7 | 
           month == 10) %>%
  select(date,
         year,
         month,
         quaterly,
         sex,
         work_rate,
         work_study_house_rate) %>%
  na.omit

```

## Employment rate

- Report $e_{g,m,y} = \frac{Employment_{g,m,y}}{Population_{g,m,y}}$, where $Employment_{g,m,y}$ and $Population_{g,m,y}$ are numbers of employment and population over 15 years old in month $m$, year $y$ and gender group $g$, respectively.

```{r}
raw %>%
  gather(work_rate,
         work_study_house_rate,
         key = "type",
         value = "y") %>%
  ggplot(aes(x = date,
             y = y,
             color = sex,
             linetype = type)
         ) +
  geom_line() +
  geom_point() +
  theme_bw() +
  ylab("employment rate")
```

## Year-to-year difference

- Report change of employment rate $\tilde e_{g,m,y}=e_{g,m,y}/e_{g,m,y-1}$

```{r}
raw %>%
  gather(work_rate,
         work_study_house_rate,
         key = "type",
         value = "y") %>%
  arrange(sex,
          type,
          quaterly,
          year) %>%
  group_by(sex,
           type,
           quaterly) %>%
  mutate(y = y/lag(y)) %>%
  ungroup %>%
  filter(year >= 2013) %>%
  ggplot(aes(x = date,
             y = y,
             color = sex,
             linetype = type,
             shape = type)
         ) +
  geom_line() +
  geom_point()  +
  geom_hline(yintercept = 1) +
  ylab("") +
  xlab("") +
  theme_bw() +
  theme(legend.position = "bottom")
```

## Gender gap

- Report change of employment rate $\tilde e_{male,m,y}-\tilde e_{female,m,y}$

```{r}
raw %>%
  gather(work_rate,
         work_study_house_rate,
         key = "type",
         value = "y") %>%
  arrange(sex,
          type,
          quaterly,
          year) %>%
  group_by(sex,
           type,
           quaterly) %>%
  mutate(y = y/lag(y)) %>%
  ungroup %>%
  arrange(type,
          quaterly,
          year,
          sex) %>%
  group_by(type,
           quaterly,
           year) %>%
  mutate(y = y - lag(y)) %>%
  ungroup %>%
  filter(year >= 2013) %>%
  na.omit %>%
  ggplot(aes(x = date,
             y = y,
             linetype = type,
             shape = type)
         ) +
  geom_line() +
  geom_point() +
  geom_hline(yintercept = 0) +
  ylab("") +
  xlab("") +
  theme_bw() +
  theme(legend.position = "bottom")
```


